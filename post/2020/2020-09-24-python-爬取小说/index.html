<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Python3爬取小说章节 - 张华的博客</title>
<meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=Cache-Control content="no-transform"><meta http-equiv=Cache-Control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="Hustbill"><meta name=description content="网络小说《侯大利刑侦笔记》比较吸引人，在手机上的微信读书App看得不过瘾。于是找到了一个小说论坛，可以顺畅地看小说了，但是一页一页地点击论坛"><meta name=keywords content="Python爬虫"><meta name=generator content="Hugo 0.124.1 with theme even"><link rel=canonical href=http://localhost:1313/post/2020/2020-09-24-python-%E7%88%AC%E5%8F%96%E5%B0%8F%E8%AF%B4/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="Python3爬取小说章节"><meta property="og:description" content="网络小说《侯大利刑侦笔记》比较吸引人，在手机上的微信读书App看得不过瘾。于是找到了一个小说论坛，可以顺畅地看小说了，但是一页一页地点击论坛"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/post/2020/2020-09-24-python-%E7%88%AC%E5%8F%96%E5%B0%8F%E8%AF%B4/"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-09-24T18:17:13-08:00"><meta property="article:modified_time" content="2020-09-24T18:17:13-08:00"><meta itemprop=name content="Python3爬取小说章节"><meta itemprop=description content="网络小说《侯大利刑侦笔记》比较吸引人，在手机上的微信读书App看得不过瘾。于是找到了一个小说论坛，可以顺畅地看小说了，但是一页一页地点击论坛"><meta itemprop=datePublished content="2020-09-24T18:17:13-08:00"><meta itemprop=dateModified content="2020-09-24T18:17:13-08:00"><meta itemprop=wordCount content="882"><meta itemprop=keywords content="Python,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Python3爬取小说章节"><meta name=twitter:description content="网络小说《侯大利刑侦笔记》比较吸引人，在手机上的微信读书App看得不过瘾。于是找到了一个小说论坛，可以顺畅地看小说了，但是一页一页地点击论坛"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>张华的博客</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a><a href=/about/><li class=mobile-menu-item>About</li></a><a href=/links/><li class=mobile-menu-item>Links</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>张华的博客</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=/about/>About</a></li><li class=menu-item><a class=menu-item-link href=/links/>Links</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Python3爬取小说章节</h1><div class=post-meta><span class=post-time>2020-09-24</span><div class=post-category><a href=/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/>技术笔记</a></div><span class=more-meta>约 882 字 </span><span class=more-meta>预计阅读 2 分钟</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class="post-toc-content always-active"><nav id=TableOfContents></nav></div></div><div class=post-content><p>网络小说《侯大利刑侦笔记》比较吸引人，在手机上的微信读书App看得不过瘾。于是找到了一个小说论坛，可以顺畅地看小说了，但是一页一页地点击论坛网页，也有些费劲，还需要看一些无聊的广告栏。能否用Python爬虫程序一次性下载所有小说页面呢？</p><p>心里有了这个念头，说干就干，索性参考网友的Python程序，自己修改一番，就能一股脑儿地把论坛里的小说页面都下载下来了。合并生成一个txt文件，放入Kindle电子书里面，看起来比电脑屏幕对眼睛友好一点。比较不伤眼。</p><p>代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#coding=utf-8</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>glob</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.request</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>urllib.parse</span> <span class=kn>import</span> <span class=n>urljoin</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>urllib.parse</span> <span class=kn>import</span> <span class=n>urlparse</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>cleanhtml</span><span class=p>(</span><span class=n>raw_html</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=n>cleanr</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=s1>&#39;&lt;.*?&gt;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>cleantext</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=n>cleanr</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>raw_html</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>cleantext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>fetch_section</span><span class=p>(</span><span class=n>webroot</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>page</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=mi>9</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;正在下载第&#39;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>page</span><span class=p>)</span><span class=o>+</span><span class=s1>&#39;页小说&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>url</span> <span class=o>=</span> <span class=s1>&#39;http://www.cangshubao.net/forum-915-&#39;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>page</span><span class=p>)</span><span class=o>+</span><span class=s1>&#39;.html&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;User-Agent&#39;</span><span class=p>:</span><span class=s1>&#39;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6&#39;</span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>request</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>urlopen</span><span class=p>(</span><span class=n>request</span><span class=p>,</span><span class=n>timeout</span><span class=o>=</span><span class=mi>180</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=c1>#print (response.read().decode(&#39;gbk&#39;))</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>urllib</span><span class=o>.</span><span class=n>error</span><span class=o>.</span><span class=n>URLError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>e</span><span class=p>,</span><span class=s2>&#34;code&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>e</span><span class=o>.</span><span class=n>code</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>e</span><span class=p>,</span><span class=s2>&#34;reason&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>e</span><span class=o>.</span><span class=n>reason</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># html = response.read().decode(&#39;utf-8&#39;)</span>
</span></span><span class=line><span class=cl>        <span class=n>html</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;gbk&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1>#print html</span>
</span></span><span class=line><span class=cl>        <span class=c1># pattern = re.compile(u&#39;&lt;li&gt;.*?&lt;div class=&#34;s&#34;&gt;.*?target=&#34;_blank&#34;&gt;(.*?)&lt;/a&gt;&lt;br /&gt;大小：(.*?)&lt;br&gt;.*?&lt;/em&gt;&lt;br&gt;更新：(.*?)&lt;/div&gt;.*?&lt;a href=&#34;(.*?)&#34;&gt;&lt;img.*?&gt;(.*?)&lt;/a&gt;.*?&lt;div class=&#34;u&#34;&gt;(.*?)&lt;/div&gt;&#39;,re.S)</span>
</span></span><span class=line><span class=cl>        <span class=c1># pattern = re.compile(u&#39;&lt;a href=&#34;thread-1453325-1-3.html&#34;&gt;第205章行内人的密报&lt;/a&gt;&#39;)</span>
</span></span><span class=line><span class=cl>        <span class=c1>#  pattern = re.compile(u&#39;&lt;span id=&#34;(.*?)&#34;&gt;&lt;a href=&#34;(.*?)&#34;&gt;&lt;/a&gt;&lt;/span&gt;&#39;)</span>
</span></span><span class=line><span class=cl>        <span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>u</span><span class=s1>&#39;&lt;span id=&#34;(.*?)&#34;&gt;&lt;a href=&#34;(.*?)&#34;&gt;第(.*?)&lt;/a&gt;&lt;/span&gt;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>items</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span><span class=n>html</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># print (items)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>items</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>book_thread</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;gbk&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>book_link</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>book_name</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>book_full_link</span> <span class=o>=</span> <span class=n>urljoin</span><span class=p>(</span><span class=n>webroot</span><span class=p>,</span> <span class=n>book_link</span><span class=p>)</span>   <span class=c1># 构建书的绝对地址</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1>#请求地址</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>request</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>book_full_link</span><span class=p>,</span><span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>response</span> <span class=o>=</span><span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>urlopen</span><span class=p>(</span><span class=n>request</span><span class=p>,</span><span class=n>timeout</span><span class=o>=</span><span class=mi>180</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span> <span class=n>urllib</span><span class=o>.</span><span class=n>error</span><span class=o>.</span><span class=n>URLError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>e</span><span class=p>,</span><span class=s2>&#34;code&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=n>e</span><span class=o>.</span><span class=n>code</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>e</span><span class=p>,</span><span class=s2>&#34;reason&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=n>e</span><span class=o>.</span><span class=n>reason</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>html</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;gbk&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=s1>&#39;&lt;table cellspacing=&#34;0&#34; cellpadding=&#34;0&#34;&gt;&lt;tr&gt;&lt;td class=&#34;t_msgfont&#34; id=&#34;(.*?)&#34;&gt;&lt;font size=&#34;5&#34;&gt;(.*?)&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#39;</span><span class=p>,</span><span class=n>re</span><span class=o>.</span><span class=n>S</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>section_content</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span><span class=n>html</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1># down txt</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>fp</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=n>book_name</span><span class=o>+</span><span class=s1>&#39;.txt&#39;</span><span class=p>,</span><span class=s1>&#39;w&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span> <span class=ne>IOError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=s1>&#39;&lt;font size=&#34;5&#34;&gt;(.*?)&lt;/font&gt;&lt;br /&gt;&#39;</span><span class=p>,</span><span class=n>re</span><span class=o>.</span><span class=n>S</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>book_name</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span><span class=n>book_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>fp</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=n>book_name</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>+</span><span class=s1>&#39;.txt&#39;</span><span class=p>,</span><span class=s1>&#39;w&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;start download&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>cleanTxt</span> <span class=o>=</span> <span class=n>cleanhtml</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>section_content</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>                <span class=n>fp</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>cleanTxt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;down finish</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>fp</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;该条目解析出现错误，忽略&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>fp</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;error.log&#39;</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>fp</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s1>&#39;page:&#39;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>page</span><span class=p>)</span><span class=o>+</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>fp</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;gbk&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>fp</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>There is an error in parsing process.</span><span class=se>\n\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>fp</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>merge_txt_files</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>read_files</span> <span class=o>=</span> <span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=s2>&#34;*.txt&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># print (read_files)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;result.txt&#34;</span><span class=p>,</span> <span class=s2>&#34;wb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>outfile</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>read_files</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>infile</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>outfile</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;gbk&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>outfile</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>infile</span><span class=o>.</span><span class=n>read</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 获取排行榜首页内容</span>
</span></span><span class=line><span class=cl>    <span class=n>webroot</span> <span class=o>=</span> <span class=s1>&#39;http://www.cangshubao.net/&#39;</span>
</span></span><span class=line><span class=cl>    <span class=c1># fetch_section(webroot)</span>
</span></span><span class=line><span class=cl>    <span class=n>merge_txt_files</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>Hustbill</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2020-09-24</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/python/>Python</a></div><nav class=post-nav><a class=prev href=/post/2020/2020-11-21--ill-be-the-one/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">英雄莫问出处</span>
<span class="prev-text nav-mobile">上一篇</span>
</a><a class=next href=/post/2020/2020-09-13-%E6%9C%89%E5%93%AA%E4%BA%9B%E4%BD%A0%E6%AF%95%E4%B8%9A%E5%A4%9A%E5%B9%B4%E5%90%8E%E6%89%8D%E6%98%8E%E7%99%BD%E7%9A%84%E9%81%93%E7%90%86/><span class="next-text nav-default">有哪些你毕业多年后才明白的道理?</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname==="localhost")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="hustbill",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:billzhang2020@email.com class="iconfont icon-email" title=email></a><a href=https://tinyurl.com/y25haluf class="iconfont icon-stack-overflow" title=stack-overflow></a><a href=https://github.com/hustbill class="iconfont icon-github" title=github></a><a href=http://localhost:1313/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动
</span><span class=division>|</span>
<span class=theme-info>主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span><span class=copyright-year>&copy;
2015 -
2024<span class=heart><i class="iconfont icon-heart"></i></span><span>Hustbill</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script></body></html>